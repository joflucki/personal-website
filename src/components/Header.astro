---
import { getRelativeLocaleUrl } from "astro:i18n";
import { getLocaleFromUrl, useTranslations } from "../i18n/utils";
import LanguagePicker from "./LanguagePicker.astro";
import Menu from "../assets/menu.svg";
import Close from "../assets/close.svg";

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
---

<header>
	<nav>
		<h2><a href={getRelativeLocaleUrl(locale, "")}>JF</a></h2>
		<div class="internal-links">
			<a href={getRelativeLocaleUrl(locale, "")}>{t("nav.home")}</a>
			<a href={getRelativeLocaleUrl(locale, "posts")}>{t("nav.posts")}</a>
			<a href={getRelativeLocaleUrl(locale, "projects")}>
				{t("nav.projects")}
			</a>
			<a href={getRelativeLocaleUrl(locale, "education")}>
				{t("nav.education")}
			</a>
			<a href={getRelativeLocaleUrl(locale, "volunteering")}>
				{t("nav.volunteering")}
			</a>
		</div>
		<div class="spacer"></div>
		<div class="social-links">
			<a href="mailto:contact@jonas-flueckiger.ch" target="_blank">
				<span class="sr-only">Contact Jonas Fl端ckiger by email </span>
				<svg
					height="26"
					viewBox="60 -900 900 900"
					width="26"
					aria-hidden="true"
					fill="#e3e3e3"
					><path
						d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480v58q0 59-40.5 100.5T740-280q-35 0-66-15t-52-43q-29 29-65.5 43.5T480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480v58q0 26 17 44t43 18q26 0 43-18t17-44v-58q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93h200v80H480Zm0-280q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Z"
					></path></svg
				>
			</a>
			<a href="https://github.com/joflucki" target="_blank">
				<span class="sr-only">
					Go to Jonas Fl端ckiger's Github account
				</span>
				<svg
					viewBox="0 0 16 16"
					aria-hidden="true"
					width="24"
					height="24"
					><path
						fill="currentColor"
						d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
					></path></svg
				>
			</a>
			<a href="https://linkedin.com/in/jonas-fl端ckiger" target="_blank">
				<span class="sr-only"
					>Go to Jonas Fl端ckiger's Linkedin account</span
				>
				<svg
					viewBox="0 0 72 72"
					aria-hidden="true"
					width="24"
					height="24"
					><path
						d="M8,72 L64,72 C68.418278,72 72,68.418278 72,64 L72,8 C72,3.581722 68.418278,-8.11624501e-16 64,0 L8,0 C3.581722,8.11624501e-16 -5.41083001e-16,3.581722 0,8 L0,64 C5.41083001e-16,68.418278 3.581722,72 8,72 Z"
						fill="currentColor"></path><path
						d="M62,62 L51.315625,62 L51.315625,43.8021149 C51.315625,38.8127542 49.4197917,36.0245323 45.4707031,36.0245323 C41.1746094,36.0245323 38.9300781,38.9261103 38.9300781,43.8021149 L38.9300781,62 L28.6333333,62 L28.6333333,27.3333333 L38.9300781,27.3333333 L38.9300781,32.0029283 C38.9300781,32.0029283 42.0260417,26.2742151 49.3825521,26.2742151 C56.7356771,26.2742151 62,30.7644705 62,40.051212 L62,62 Z M16.349349,22.7940133 C12.8420573,22.7940133 10,19.9296567 10,16.3970067 C10,12.8643566 12.8420573,10 16.349349,10 C19.8566406,10 22.6970052,12.8643566 22.6970052,16.3970067 C22.6970052,19.9296567 19.8566406,22.7940133 16.349349,22.7940133 Z M11.0325521,62 L21.769401,62 L21.769401,27.3333333 L11.0325521,27.3333333 L11.0325521,62 Z"
						fill="#050505"></path></svg
				>
			</a>
		</div>
		<div id="language-picker-container">
			<LanguagePicker />
		</div>
		<div id="burger-menu-container">
			<Menu />
		</div>
		<div id="close-menu-container">
			<Close />
		</div>
	</nav>
	<style>
		header {
			width: 100%;
			position: fixed;
			margin: 0;
			padding: 0;
			background: rgba(06, 06, 06, 0.75);
			border-bottom: 1px solid var(--gray-dark);
			backdrop-filter: blur(10px);
			transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1);
			z-index: 1;
		}
		header.hidden {
			translate: 0px -100px;
		}
		h2 {
			margin: 0;
			padding: 0;
			font-size: 1em;
			margin-right: 2em;
		}

		h2 a {
			text-decoration: none;
		}
		nav {
			padding: 0.5em 0;
			display: flex;
			align-items: center;
			justify-content: start;
			margin: 0 3em;
		}
		nav a {
			color: var(--white);
			text-decoration-color: transparent;
			transition: text-decoration-color 0.15s linear;
		}
		nav .internal-links a:hover {
			text-decoration-color: var(--white);
		}
		.internal-links {
			display: flex;
			gap: 1em;
			translate: 0px -1.5px;
		}
		.spacer {
			flex-grow: 1;
			min-width: 1em;
			min-height: 1em;
		}
		.social-links {
			margin-right: 1em;
		}
		.social-links,
		.social-links a {
			align-items: center;
			gap: 1em;
			display: flex;
		}
		#burger-menu-container,
		#close-menu-container {
			visibility: hidden;
		}
		@media (max-width: 720px) {
			.spacer {
				display: none;
			}
			h2 {
				position: fixed;
				top: 0.4em;
				left: 1em;
			}
			header {
				height: 2em;
				padding: 0;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
			}
			header.opened {
				height: 100vh;
			}
			header.hidden.opened {
				translate: none;
			}
			.social-links {
				visibility: hidden;
				align-items: center;
				justify-content: center;
				margin-right: 0;
			}
			.opened .social-links {
				visibility: visible;
				order: 3;
			}
			.opened .internal-links {
				visibility: visible;
				order: 2;
			}
			.internal-links {
				visibility: hidden;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				z-index: -1;
			}
			#language-picker-container {
				visibility: hidden;
			}
			#burger-menu-container,
			#close-menu-container {
				visibility: visible;
				display: flex;
				align-items: center;
				justify-content: center;
				position: fixed;
				top: 0.4em;
				right: 1em;
				cursor: pointer;
				transition: all 0.25s ease-in-out;
			}
			#burger-menu-container {
				scale: 1;
				rotate: 0deg;
			}
			#close-menu-container {
				visibility: hidden;
				scale: 0.1;
				rotate: 180deg;
			}
			.opened #close-menu-container {
				visibility: visible;
				scale: 1;
				rotate: 0deg;
			}
			.opened #burger-menu-container {
				visibility: hidden;
				scale: 0.1;
				rotate: -180deg;
			}
			nav {
				margin: 0;
				padding: 0;
				height: min-content;
				gap: 2em;
			}
			.opened nav {
				flex-direction: column;
				align-items: center;
				justify-content: space-around;
			}
			.opened #language-picker-container {
				visibility: visible;
				order: 1;
			}
		}
	</style>

	<script>
		const header = document.querySelector("header");
		let lastScroll = 0;
		window.addEventListener("scroll", () => {
			const currentScroll = window.pageYOffset;
			if (currentScroll > lastScroll) {
				header?.classList.add("hidden");
			} else {
				// Scrolling up
				header?.classList.remove("hidden");
			}
			lastScroll = currentScroll;
		});
	</script>

	<script>
		let headerOpened = false;
		const burgerMenu = document.querySelector("#burger-menu-container");
		const closeMenu = document.querySelector("#close-menu-container");
		const header = document.querySelector("header");
		const html = document.querySelector("html");
		const toggleMenu = () => {
			headerOpened = !headerOpened;
			headerOpened
				? header?.classList.add("opened")
				: header?.classList.remove("opened");

			headerOpened
				? html?.classList.add("no-scroll")
				: html?.classList.remove("no-scroll");
		};
		burgerMenu?.addEventListener("click", toggleMenu);
		closeMenu?.addEventListener("click", toggleMenu);
	</script>
</header>
