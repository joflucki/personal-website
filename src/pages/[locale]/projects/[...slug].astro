---
import { type CollectionEntry, getCollection, render } from "astro:content";
import Project from "../../../layouts/Project.astro";
import { LANGUAGES } from "../../../i18n/ui";

export async function getStaticPaths() {
	const availableLocales = Object.keys(LANGUAGES) as [keyof typeof LANGUAGES];
	return (
		await Promise.all(
			availableLocales.map(async (availableLocale) => {
				const projects = await getCollection(
					"projects",
					(project) => project.data.locale === availableLocale,
				);
				return projects.map((project) => ({
					params: {
						locale: availableLocale,
						slug: project.id.split("/").at(-1),
					},
					props: project,
				}));
			}),
		)
	).flat();
}
type Props = CollectionEntry<"projects">;

const project = Astro.props;
const { Content, headings } = await render(project);
---

<Project {...project.data} headings={headings}>
	<Content />
</Project>
