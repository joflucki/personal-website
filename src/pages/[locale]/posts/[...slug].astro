---
import { type CollectionEntry, getCollection, render } from "astro:content";
import BlogPost from "../../../layouts/BlogPost.astro";
import { LANGUAGES } from "../../../i18n/ui";
import type { GetStaticPaths } from "astro";

export const getStaticPaths = (async () => {
	const availableLocales = Object.keys(LANGUAGES) as [keyof typeof LANGUAGES];
	return (
		await Promise.all(
			availableLocales.map(async (availableLocale) => {
				const posts = await getCollection(
					"posts",
					(post) => post.data.locale === availableLocale,
				);
				return posts.map((post) => ({
					params: {
						locale: availableLocale,
						slug: post.id.split("/").at(-1),
					},
					props: post,
				}));
			}),
		)
	).flat();
}) satisfies GetStaticPaths;
type Props = CollectionEntry<"posts">;

const post = Astro.props;
const { Content, headings } = await render(post);
---

<BlogPost {...post.data} headings={headings}>
	<Content />
</BlogPost>
